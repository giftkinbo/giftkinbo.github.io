<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶∞‡¶Æ</title>
  <meta name="description" content="‡¶ó‡¶ø‡¶´‡¶ü ‡¶ï‡¶ø‡¶®‡¶¨‡ßã - ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø-‡¶∏‡ßç‡¶ü‡ßá‡¶™ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶∞‡¶Æ">
  <style>
    :root {
      --primary-color:#ff4b8b; /* Pink gift ribbon */
      --primary-2:#ff7ab3;     /* Gift gradient partner */
      --accent:#ffd166;        /* Confetti gold */
      --teal:#3ad1c3;          /* Fresh accent */
      --neon:#b084f7;          /* Futuristic glow */
      --dark:#1a1a1a; --muted:#666; --light:#f7f7fb; --white:#fff;
    }
    * { box-sizing: border-box; }
    body {
      margin:0; font-family: 'Hind Siliguri', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#222;
      background:
        radial-gradient(900px 500px at 110% -10%, rgba(255,122,179,.10), transparent 60%),
        radial-gradient(700px 420px at -10% 0%, rgba(176,132,247,.10), transparent 55%),
        linear-gradient(180deg, #ffffff 0%, #fff9fc 100%);
      min-height: 100vh;
    }
    .container { max-width: 960px; margin: 0 auto; padding: 24px 16px; }
    .wizard-card { position:relative; background: rgba(255,255,255,.92); -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px); border-radius: 16px; box-shadow: 0 14px 40px rgba(176,132,247,.12), 0 6px 18px rgba(0,0,0,.04); padding: 20px; border:1px solid #f1f1f4; }
    .wizard-card::before { content:""; position:absolute; inset: -1px; border-radius: 16px; padding:1px; background: linear-gradient(135deg, rgba(255,75,139,.5), rgba(176,132,247,.5)); -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events:none; }
    .wizard-header { display:flex; align-items:center; justify-content: space-between; gap:12px; margin-bottom:12px; background: rgba(255,255,255,.6); padding:10px 12px; border-radius: 12px; border:1px solid #eee; }
    .wizard-title { font-size: 1.45rem; margin:0; background: linear-gradient(90deg, var(--primary-color), var(--primary-2)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .progress { background: #f3f3f6; height: 9px; border-radius: 999px; overflow: hidden; margin: 12px 0 16px; border:1px solid #eee; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary-color), var(--accent), var(--primary-2)); transition: width .3s ease; filter: drop-shadow(0 0 6px rgba(176,132,247,.25)); }
    .steps { display:grid; grid-template-columns: repeat(4,1fr); gap:8px; margin-bottom: 10px; }
    .step-chip { position:relative; text-align:center; padding:8px 12px 8px 26px; border-radius: 12px; background: #f8f8fc; color: #4a4a4a; font-weight:700; font-size:.9rem; border:1px solid #e8e8f0; display:flex; align-items:center; justify-content:center; }
    .step-chip::before { content:""; position:absolute; left:10px; width:10px; height:10px; border-radius:50%; background: linear-gradient(180deg, var(--primary-color), var(--primary-2)); box-shadow: 0 0 0 3px rgba(255,75,139,.12); }
    .step-chip.active { background: #fff; color: #222; border-color: #dedee6; }
    .step { display:none; }
    .step.active { display:block; animation: fade .25s ease; }
    @keyframes fade { from { opacity:0; transform: translateY(6px);} to { opacity:1; transform:none;} }
    .grid { display:grid; gap:14px; }
    @media(min-width: 640px){ .grid.two { grid-template-columns: 1fr 1fr; } }
    label { display:block; font-weight:700; margin-bottom:6px; color:#333; }
    input[type="text"], input[type="tel"], select, textarea { width:100%; padding:12px 14px; border:2px solid #ffe3ef; border-radius: 12px; font-size: 1rem; transition: .2s border-color, .2s box-shadow, .2s transform; background:#fff; }
    input:hover, select:hover, textarea:hover { transform: translateY(-1px); }
    textarea { min-height: 96px; resize: vertical; }
    input:focus, select:focus, textarea:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 4px rgba(255,75,139,.12); }
    .nav { display:flex; justify-content: space-between; gap:12px; margin-top: 16px; }
    .btn { padding:12px 18px; border:none; border-radius: 999px; cursor:pointer; font-weight:800; letter-spacing:.2px; transition: transform .15s ease, box-shadow .2s ease, background .2s ease; }
    .btn:active { transform: scale(.98); }
    .btn-secondary { background:#f4f4f7; color:#333; border:1px solid #e8e8ef; }
    .btn-secondary:hover { box-shadow: 0 4px 12px rgba(0,0,0,.06); }
    .btn-primary { background: linear-gradient(90deg, var(--primary-color), var(--primary-2)); color:#fff; box-shadow: 0 10px 22px rgba(255,75,139,.20), 0 2px 10px rgba(176,132,247,.14); }
    .btn-primary:hover { box-shadow: 0 14px 28px rgba(255,75,139,.25), 0 4px 14px rgba(176,132,247,.20); }
    .summary { background: #fafafd; border:1px solid #eee; border-radius: 12px; padding: 12px; }
    .cost { display:grid; gap:8px; }
    .cost .row { display:flex; justify-content: space-between; align-items:center; padding: 8px 0; border-bottom: 1px dashed #ececf1; }
    .cost .row.total { font-size: 1.05rem; font-weight:800; border-bottom:none; color:#222; }
    .note { display:none; }
    /* Success confetti dots */
    #successState { position: relative; }
    #successState::before, #successState::after {
      content:""; position:absolute; inset:-10px; pointer-events:none; background:
        radial-gradient(6px 6px at 10% 20%, var(--accent), transparent 60%),
        radial-gradient(6px 6px at 90% 30%, #ff9dcb, transparent 60%),
        radial-gradient(6px 6px at 20% 80%, var(--teal), transparent 60%),
        radial-gradient(6px 6px at 80% 70%, #ffa3c7, transparent 60%);
      opacity:.25;
    }
    /* Mobile spacing */
    @media(max-width: 420px){
      .wizard-card { padding: 14px; }
      .wizard-title { font-size: 1.25rem; }
      .step-chip { font-size:.86rem; padding:6px 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="wizard-card">
      <div class="wizard-header">
        <img src="logo.png" alt="Gift Kinbo" style="height:28px">
        <h1 class="wizard-title">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶∞‡¶Æ</h1>
      </div>

      <div class="steps" aria-label="Steps" style="grid-template-columns: repeat(5, 1fr);">
        <div class="step-chip active" data-step-chip="0">‡ßß. ‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü</div>
        <div class="step-chip" data-step-chip="1">‡ß®. ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</div>
        <div class="step-chip" data-step-chip="2">‡ß©. ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø</div>
        <div class="step-chip" data-step-chip="3">‡ß™. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
        <div class="step-chip" data-step-chip="4">‡ß´. ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</div>
      </div>
      <div class="progress" aria-hidden="true"><div class="progress-bar" id="progressBar"></div></div>

      <form id="wizardForm" novalidate>
        <div class="step active" data-step="0">
          <div class="grid two">
            <div>
              <label for="recipientName">‡¶Ø‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡¶ø‡¶´‡¶ü ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
              <input type="text" id="recipientName" name="recipientName" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∏‡¶æ‡¶¨‡¶∞‡¶ø‡¶®‡¶æ ‡¶Ü‡¶ï‡ßç‡¶§‡¶æ‡¶∞" required>
              <div class="note">‡¶®‡¶æ‡¶Æ ‡¶†‡¶ø‡¶ï‡¶†‡¶æ‡¶ï ‡¶¶‡¶ø‡¶≤‡ßá ‡¶∏‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶ú‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá ‚ú®</div>
            </div>
            <div>
              <label for="recipientGender">‡¶ú‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞</label>
              <select id="recipientGender" name="recipientGender" required>
                <option value="">‡¶ú‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                <option value="male">‡¶õ‡ßá‡¶≤‡ßá</option>
                <option value="female">‡¶Æ‡ßá‡ßü‡ßá</option>
              </select>
              <div class="note">‡¶è‡¶ü‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ó‡¶ø‡¶´‡¶ü ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶®‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶¨‡ßá üéÅ</div>
            </div>
            <div>
              <label for="relationship">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï</label>
              <input type="text" id="relationship" name="relationship" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶æ‡¶¨‡¶æ, ‡¶Æ‡¶æ, ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ" required>
              <div class="note">‡¶Ü‡¶π‡¶æ! ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï ‡¶Ø‡¶§ ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞, ‡¶ó‡¶ø‡¶´‡¶ü ‡¶§‡¶§ ‡¶™‡¶æ‡¶∞‡¶´‡ßá‡¶ï‡ßç‡¶ü üíù</div>
            </div>
            <div>
              <label for="recipientAge">‡¶¨‡¶Ø‡¶º‡¶∏</label>
              <input type="text" id="recipientAge" name="recipientAge" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 12" required pattern="[0-9]+" title="‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡¶®">
              <div class="note">‡¶¨‡¶Ø‡¶º‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ó‡¶ø‡¶´‡¶ü ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º üß∏</div>
            </div>
            <div>
              <label for="occasion">‡¶â‡¶™‡¶≤‡¶ï‡ßç‡¶∑</label>
              <input type="text" id="occasion" name="occasion" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ú‡¶®‡ßç‡¶Æ‡¶¶‡¶ø‡¶®, ‡¶¨‡¶ø‡¶¨‡¶æ‡¶π ‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï‡ßÄ" required>
              <div class="note">‡¶â‡¶™‡¶≤‡¶ï‡ßç‡¶∑‡¶ï‡ßá ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶á ‡¶ï‡¶®‡¶∏‡ßá‡¶™‡ßç‡¶ü üéâ</div>
            </div>
            <div>
              <label for="budget">‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</label>
              <input type="text" id="budget" name="budget" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 499" required pattern="[0-9]+" title="‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡¶®">
              <div class="note">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ú‡ßá‡¶ü‡ßá‡¶á ‡¶π‡¶¨‡ßá ‡¶π‡¶æ‡¶∏‡¶ø‡¶∞ ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§ üòÑ</div>
            </div>
            <div style="grid-column: 1 / -1;">
              <label for="preferences">‡¶™‡¶õ‡¶®‡ßç‡¶¶-‡¶Ö‡¶™‡¶õ‡¶®‡ßç‡¶¶</label>
              <textarea id="preferences" name="preferences" rows="3" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶∞‡¶ô, ‡¶´‡ßÅ‡¶≤, ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞"></textarea>
              <div class="note">‡¶Ø‡¶§ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶ú‡¶æ‡¶®‡¶¨‡ßá‡¶®, ‡¶§‡¶§ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶π‡¶¨‡ßá ‡¶ó‡¶ø‡¶´‡¶ü üìå</div>
            </div>
          </div>
        </div>

        <div class="step" data-step="1">
          <div class="grid two">
            <div>
              <label for="senderName">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
              <input type="text" id="senderName" name="senderName" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶π‡ßÅ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶" required>
            </div>
            <div>
              <label for="senderPhone">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
              <input type="tel" id="senderPhone" name="senderPhone" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 01300000000" required>
            </div>
          </div>
        </div>

        <div class="step" data-step="2">
          <div class="grid two">
            <div>
              <label for="deliveryArea">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶è‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ</label>
              <select id="deliveryArea" name="deliveryArea" required>
                <option value="">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                <option value="inside">‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá</option>
                <option value="outside">‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá</option>
              </select>
            </div>
            <div>
              <label for="recipientPhone">‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label>
              <input type="tel" id="recipientPhone" name="recipientPhone" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 01745897322" required>
            </div>
            <div style="grid-column: 1 / -1;">
              <label for="deliveryAddress">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
              <textarea id="deliveryAddress" name="deliveryAddress" rows="3" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required></textarea>
            </div>
            <div style="grid-column: 1 / -1;" class="summary">
              <div class="cost">
                <div class="row"><span>‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</span><strong id="budgetAmount">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
                <div class="row"><span>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</span><strong id="deliveryAmount">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
                <div class="row total"><span>‡¶Æ‡ßã‡¶ü</span><strong id="totalAmount">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
              </div>
              <p class="note">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: ‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá 59 ‡¶ü‡¶æ‡¶ï‡¶æ, ‡¶¨‡¶æ‡¶á‡¶∞‡ßá 99 ‡¶ü‡¶æ‡¶ï‡¶æ</p>
            </div>
          </div>
        </div>

        <div class="step" data-step="3">
          <div class="grid">
            <div>
              <label for="paymentMethod">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°</label>
              <select id="paymentMethod" name="paymentMethod">
                <option value="cod" selected>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ö‡¶® ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø (COD)</option>
                <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                <option value="rocket">‡¶∞‡¶ï‡ßá‡¶ü</option>
                <option value="nagad">‡¶®‡¶ó‡¶¶</option>
              </select>
              <div class="note">‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ ‡¶¶‡ßá‡¶Ø‡¶º‡¶æ ‡¶π‡¶¨‡ßá ‚úÖ</div>
            </div>
            <div id="customerBkashInput" style="display:none;">
              <label for="customerBkashNumber">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
              <input type="tel" id="customerBkashNumber" name="customerBkashNumber" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 01712345678" pattern="[0-9]+" title="‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡¶®">
              <div class="note">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶® ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá‡¶®</div>
            </div>
            <div id="paymentNumberDisplay" style="display:none;">
              <div class="summary"><strong>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞:</strong> <span id="paymentNumber"></span></div>
              <button type="button" class="btn btn-secondary" id="copyPaymentNumber">‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
              <div id="paymentDescription" class="note"></div>
            </div>
            <div class="summary">
              <div class="cost">
                <div class="row"><span>‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</span><strong id="budgetAmount2">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
                <div class="row"><span>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</span><strong id="deliveryAmount2">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
                <div class="row total"><span>‡¶Æ‡ßã‡¶ü</span><strong id="totalAmount2">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
              </div>
              <p class="note"><i>‡¶ó‡¶ø‡¶´‡¶ü ‡¶π‡¶æ‡¶§‡ßá ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶§‡¶æ‡¶∞‡¶™‡¶∞‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¶‡¶ø‡¶¨‡ßá‡¶®</i></p>
            </div>
          </div>
        </div>

        <div class="step" data-step="4">
          <div class="grid">
            <div class="summary" id="reviewBlock">
              <h3 style="margin:0 0 8px 0;">‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
              <div id="reviewList" class="grid" style="gap:8px;"></div>
              <div class="cost" style="margin-top:8px;">
                <div class="row"><span>‡¶¨‡¶æ‡¶ú‡ßá‡¶ü</span><strong id="budgetAmount3">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
                <div class="row"><span>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</span><strong id="deliveryAmount3">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
                <div class="row total"><span>‡¶Æ‡ßã‡¶ü</span><strong id="totalAmount3">‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></div>
              </div>
            </div>
          </div>
        </div>

        <div class="nav">
          <button type="button" class="btn btn-secondary" id="prevBtn">‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ</button>
          <button type="button" class="btn btn-primary" id="nextBtn">‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ</button>
          <button type="submit" class="btn btn-primary" id="submitBtn" style="display:none;">‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</button>
        </div>
      </form>
      <div id="successState" style="display:none; text-align:center; padding:24px 8px;">
        <img src="logo.png" alt="Gift Kinbo" style="height:40px; margin-bottom:8px;">
        <h2 style="margin:6px 0 4px 0;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! üéâ</h2>
        <p class="note">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ü‡¶ø‡¶Æ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡¶ø‡¶ó‡¶ó‡¶ø‡¶∞‡¶á ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶¨‡ßá‡•§</p>
        <div class="summary" style="text-align:left; margin-top:12px;">
          <h3 style="margin:0 0 8px 0;">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂</h3>
          <div id="successSummary"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCSyXJeftEfkwQ_FoQlg1sEZ3PZv9xjkLI",
      authDomain: "gift-kinbo-bd.firebaseapp.com",
      projectId: "gift-kinbo-bd",
      storageBucket: "gift-kinbo-bd.firebasestorage.app",
      messagingSenderId: "896761493540",
      appId: "1:896761493540:web:21e49df2ca453fb80180b1",
      measurementId: "G-ZVXSHQT95M",
      databaseURL: "https://gift-kinbo-bd-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    let database;
    let isFirebaseReady = false;
    
    // Initialize Firebase
    try {
      const app = initializeApp(firebaseConfig);
      database = getDatabase(app);
      isFirebaseReady = true;
      console.log('Firebase (form.html) initialized successfully');
    } catch (err) {
      console.error('Firebase init failed on form.html:', err);
      isFirebaseReady = false;
    }

    (function(){
      const steps = Array.from(document.querySelectorAll('.step'));
      const chips = Array.from(document.querySelectorAll('.step-chip'));
      const progressBar = document.getElementById('progressBar');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const submitBtn = document.getElementById('submitBtn');
      const form = document.getElementById('wizardForm');

      const budgetInput = document.getElementById('budget');
      const deliveryArea = document.getElementById('deliveryArea');
      const budgetAmount = document.getElementById('budgetAmount');
      const deliveryAmount = document.getElementById('deliveryAmount');
      const totalAmount = document.getElementById('totalAmount');
      const budgetAmount2 = document.getElementById('budgetAmount2');
      const deliveryAmount2 = document.getElementById('deliveryAmount2');
      const totalAmount2 = document.getElementById('totalAmount2');

      const paymentMethod = document.getElementById('paymentMethod');
      const customerBkashInput = document.getElementById('customerBkashInput');
      const paymentNumberDisplay = document.getElementById('paymentNumberDisplay');
      const paymentNumber = document.getElementById('paymentNumber');
      const paymentDescription = document.getElementById('paymentDescription');
      const copyPaymentNumberBtn = document.getElementById('copyPaymentNumber');
      const budgetAmount3 = document.getElementById('budgetAmount3');
      const deliveryAmount3 = document.getElementById('deliveryAmount3');
      const totalAmount3 = document.getElementById('totalAmount3');
      const reviewList = document.getElementById('reviewList');
      const successState = document.getElementById('successState');
      const successSummary = document.getElementById('successSummary');

      let current = 0;

      function formatBDT(n){
        const v = Math.max(0, Number(n||0) || 0);
        return new Intl.NumberFormat('bn-BD').format(v) + ' ‡¶ü‡¶æ‡¶ï‡¶æ';
      }

      function deliveryCharge(){
        if(deliveryArea.value === 'inside') return 59;
        if(deliveryArea.value === 'outside') return 99;
        return 0;
      }

      function updateCosts(){
        const b = Math.max(0, parseInt(budgetInput.value || '0', 10) || 0);
        const d = deliveryCharge();
        const t = b + d;
        [budgetAmount, budgetAmount2].forEach(el=> el && (el.textContent = formatBDT(b)));
        [deliveryAmount, deliveryAmount2].forEach(el=> el && (el.textContent = formatBDT(d)));
        [totalAmount, totalAmount2].forEach(el=> el && (el.textContent = formatBDT(t)));
      }

      function showStep(i){
        steps.forEach((s,idx)=> s.classList.toggle('active', idx===i));
        chips.forEach((c,idx)=> c.classList.toggle('active', idx===i));
        const pct = ((i) / (steps.length-1)) * 100;
        progressBar.style.width = pct + '%';
        prevBtn.style.display = i===0 ? 'none' : '';
        nextBtn.style.display = i===steps.length-1 ? 'none' : '';
        submitBtn.style.display = i===steps.length-1 ? '' : 'none';
        current = i;
        if(i===steps.length-1){
          populateReview();
        }
      }

      function stepRequiredFields(i){
        const fields = steps[i].querySelectorAll('input, select, textarea');
        return Array.from(fields).filter(f=> f.hasAttribute('required'));
      }

      function validateStep(i){
        let ok = true;
        stepRequiredFields(i).forEach(f=>{
          if(!f.checkValidity()){
            ok = false;
            f.reportValidity();
          }
        });
        return ok;
      }

      function goNext(){
        if(!validateStep(current)) return;
        if(current < steps.length-1) showStep(current+1);
      }
      function goPrev(){ if(current>0) showStep(current-1); }

      nextBtn.addEventListener('click', goNext);
      prevBtn.addEventListener('click', goPrev);

      // Clickable step chips: backward free, forward validates intermediates
      chips.forEach((chip, idx)=>{
        chip.style.cursor = 'pointer';
        chip.addEventListener('click', ()=>{
          if(idx === current) return;
          if(idx < current){
            showStep(idx);
            return;
          }
          // Validate current up to the target-1
          for(let i=current; i<idx; i++){
            if(!validateStep(i)){
              showStep(i);
              return;
            }
          }
          showStep(idx);
        });
      });

      // Costs update
      ['input','change'].forEach(evt=>{
        budgetInput.addEventListener(evt, updateCosts);
        deliveryArea.addEventListener(evt, updateCosts);
      });
      updateCosts();

      // Payment method behavior
      function updatePaymentUI(){
        const v = paymentMethod.value;
        if(v==='bkash'){
          customerBkashInput.style.display = '';
          paymentNumberDisplay.style.display = '';
          paymentNumber.textContent = '01745897322';
          paymentDescription.textContent = '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá "Send Money" ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§';
        } else if(v==='rocket'){
          customerBkashInput.style.display = 'none';
          paymentNumberDisplay.style.display = '';
          paymentNumber.textContent = '01234-567890';
          paymentDescription.textContent = '‡¶∞‡¶ï‡ßá‡¶ü ‡¶è‡¶ú‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®, ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡•§';
        } else if(v==='nagad'){
          customerBkashInput.style.display = 'none';
          paymentNumberDisplay.style.display = '';
          paymentNumber.textContent = '01800-000000';
          paymentDescription.textContent = '‡¶®‡¶ó‡¶¶ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®, ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡•§';
        } else {
          customerBkashInput.style.display = 'none';
          paymentNumberDisplay.style.display = 'none';
          paymentNumber.textContent = '';
          paymentDescription.textContent = '';
        }
      }
      paymentMethod.addEventListener('change', updatePaymentUI);
      updatePaymentUI();

      // Copy number
      copyPaymentNumberBtn.addEventListener('click', async ()=>{
        const text = paymentNumber.textContent.trim();
        try { await navigator.clipboard.writeText(text); copyPaymentNumberBtn.textContent = '‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'; setTimeout(()=> copyPaymentNumberBtn.textContent = '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®', 1200); } catch(e){}
      });

      function populateReview(){
        updateCosts();
        const data = new FormData(form);
        const items = [
          { label:'‡¶Ø‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ', name:'recipientName', step:0 },
          { label:'‡¶ú‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞', name:'recipientGender', step:0 },
          { label:'‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï', name:'relationship', step:0 },
          { label:'‡¶¨‡¶Ø‡¶º‡¶∏', name:'recipientAge', step:0 },
          { label:'‡¶â‡¶™‡¶≤‡¶ï‡ßç‡¶∑', name:'occasion', step:0 },
          { label:'‡¶™‡¶õ‡¶®‡ßç‡¶¶-‡¶Ö‡¶™‡¶õ‡¶®‡ßç‡¶¶', name:'preferences', step:0 },
          { label:'‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ', name:'senderName', step:1 },
          { label:'‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤', name:'senderPhone', step:1 },
          { label:'‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶è‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ', name:'deliveryArea', step:2 },
          { label:'‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤', name:'recipientPhone', step:2 },
          { label:'‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ', name:'deliveryAddress', step:2 },
          { label:'‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°', name:'paymentMethod', step:3 },
          { label:'‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞', name:'customerBkashNumber', step:3 }
        ];
        reviewList.innerHTML = '';
        items.forEach(it=>{
          const val = (data.get(it.name) || '').toString();
          if(!val) return;
          const row = document.createElement('div');
          row.className = 'grid two';
          row.innerHTML = `<div><strong>${it.label}:</strong> <span>${escapeHtml(val)}</span></div><div style="text-align:right;"><button type="button" class="btn btn-secondary" data-edit-step="${it.step}">‡¶è‡¶°‡¶ø‡¶ü</button></div>`;
          reviewList.appendChild(row);
        });
        [budgetAmount3, deliveryAmount3, totalAmount3].forEach(()=>{});
        budgetAmount3.textContent = budgetAmount.textContent;
        deliveryAmount3.textContent = deliveryAmount.textContent;
        totalAmount3.textContent = totalAmount.textContent;
        reviewList.querySelectorAll('[data-edit-step]').forEach(btn=>{
          btn.addEventListener('click', (e)=>{
            const stepIndex = parseInt(e.currentTarget.getAttribute('data-edit-step'), 10);
            showStep(stepIndex);
          });
        });
      }

      function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

      // Submit (write to Realtime Database)
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        for(let i=0;i<steps.length;i++){ if(!validateStep(i)){ showStep(i); return; } }
        submitBtn.disabled = true; submitBtn.textContent = '‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

        try {
          const data = new FormData(form);
          const payload = {
            recipientName: data.get('recipientName')||'',
            recipientGender: data.get('recipientGender')||'',
            relationship: data.get('relationship')||'',
            recipientAge: data.get('recipientAge')||'',
            occasion: data.get('occasion')||'',
            preferences: data.get('preferences')||'',
            budget: parseInt(data.get('budget')||'0', 10)||0,
            senderName: data.get('senderName')||'',
            senderPhone: data.get('senderPhone')||'',
            deliveryArea: data.get('deliveryArea')||'',
            deliveryAddress: data.get('deliveryAddress')||'',
            recipientPhone: data.get('recipientPhone')||'',
            paymentMethod: data.get('paymentMethod')||'cod',
            customerBkashNumber: data.get('customerBkashNumber')||'',
            totals: {
              budgetText: budgetAmount.textContent,
              deliveryText: deliveryAmount.textContent,
              totalText: totalAmount.textContent,
              deliveryCharge: (function(){ if(deliveryArea.value==='inside') return 59; if(deliveryArea.value==='outside') return 99; return 0; })()
            },
            meta: {
              source: 'form.html',
              userAgent: navigator.userAgent,
              createdAt: new Date().toISOString(),
              status: 'pending'
            }
          };

          // Check Firebase readiness
          console.log('Firebase status:', { isFirebaseReady, database: !!database });
          if(!isFirebaseReady || !database) {
            throw new Error('Firebase is not ready. Please refresh the page and try again.');
          }

          console.log('Submitting order to Firebase:', payload);
          const ordersRef = ref(database, 'orders');
          const result = await push(ordersRef, payload);
          console.log('Order submitted successfully with key:', result.key);

          const lines = [
            `‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü: ${payload.recipientName} (${payload.recipientGender}, ${payload.recipientAge})`,
            `‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï: ${payload.relationship}`,
            `‡¶â‡¶™‡¶≤‡¶ï‡ßç‡¶∑: ${payload.occasion}`,
            `‡¶¨‡¶æ‡¶ú‡ßá‡¶ü: ${payload.totals.budgetText} | ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø: ${payload.totals.deliveryText} | ‡¶Æ‡ßã‡¶ü: ${payload.totals.totalText}`,
            `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ/‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${payload.senderName} / ${payload.senderPhone}`,
            `‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø: ${payload.deliveryArea}, ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ${payload.deliveryAddress.slice(0,120)}`,
            `‡¶∞‡¶ø‡¶∏‡¶ø‡¶™‡¶ø‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${payload.recipientPhone}`,
            `‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü: ${payload.paymentMethod}`
          ];
          successSummary.innerHTML = '<ul style="margin:0; padding-left:18px;">' + lines.map(l=>`<li>${escapeHtml(l)}</li>`).join('') + '</ul>';
          document.getElementById('wizardForm').style.display = 'none';
          successState.style.display = '';
        } catch(err){
          console.error('Order submit failed:', err);
          const errorMsg = err.message.includes('Firebase is not ready') 
            ? '‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§' 
            : '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
          alert(errorMsg);
        } finally {
          submitBtn.disabled = false; submitBtn.textContent = '‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü';
          form.reset(); updateCosts(); updatePaymentUI(); showStep(0);
        }
      });

      // Init
      showStep(0);
    })();
  </script>
</body>
</html>


